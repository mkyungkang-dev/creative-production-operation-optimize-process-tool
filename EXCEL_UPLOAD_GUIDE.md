# 📊 엑셀 파일 업로드 가이드

생산-물류 관리 시스템에서 엑셀 파일을 사용하여 여러 작업을 한 번에 등록하거나 업데이트하는 방법을 안내합니다.

---

## 📋 목차

1. [개요](#개요)
2. [템플릿 다운로드](#템플릿-다운로드)
3. [엑셀 파일 작성](#엑셀-파일-작성)
4. [파일 업로드](#파일-업로드)
5. [업로드 모드](#업로드-모드)
6. [문제 해결](#문제-해결)
7. [API 레퍼런스](#api-레퍼런스)

---

## 개요

### 지원하는 기능

- ✅ **일괄 작업 생성**: 여러 작업을 한 번에 생성
- ✅ **일괄 작업 업데이트**: 기존 작업들을 한 번에 업데이트
- ✅ **템플릿 다운로드**: 샘플 데이터가 포함된 엑셀 템플릿 제공
- ✅ **자동 검증**: 업로드 전 데이터 유효성 검사
- ✅ **상세한 결과**: 성공/실패한 항목 및 오류 메시지 제공

### 지원하는 파일 형식

- `.xlsx` (Excel 2007+)
- `.xls` (Excel 97-2003)
- `.csv` (쉼표로 구분된 값)

---

## 템플릿 다운로드

### 단계 1: 작업 관리 페이지 접속

1. 시스템에 로그인
2. 왼쪽 메뉴에서 **"작업 관리"** 클릭

### 단계 2: 템플릿 다운로드

1. 우측 상단의 **"템플릿 다운로드"** 버튼 클릭 (녹색)
2. `작업목록_템플릿_YYYY-MM-DD.xlsx` 파일이 다운로드됩니다

### 템플릿 구성

다운로드된 엑셀 파일에는 2개의 시트가 포함되어 있습니다:

1. **작업 목록**: 실제 데이터를 입력하는 시트
2. **사용 방법**: 상세한 가이드 및 주의사항

---

## 엑셀 파일 작성

### 필수 컬럼 (반드시 입력해야 하는 항목)

| 컬럼명 | 설명 | 형식 | 예시 |
|--------|------|------|------|
| **작업명** | 작업의 이름 | 텍스트 (최대 255자) | `제품 A 제조` |
| **팀** | 담당 팀 | `production` 또는 `logistics` | `production` |
| **예상완료일** | 작업 완료 예정일 | `YYYY-MM-DD` | `2025-11-30` |

### 선택 컬럼 (입력하지 않아도 되는 항목)

| 컬럼명 | 설명 | 형식 | 기본값 | 예시 |
|--------|------|------|--------|------|
| **작업ID** | 기존 작업 ID (업데이트 시) | 숫자 | - | `12` |
| **설명** | 작업 상세 설명 | 텍스트 | 없음 | `원자재 입고 및 품질 검사` |
| **담당자** | 배정할 사용자 | 이름 또는 이메일 | 미배정 | `John Park` |
| **우선순위** | 작업 우선순위 | 1~10 | 5 | `8` |
| **상태** | 작업 상태 | `pending`, `in_progress`, `completed` | `pending` | `pending` |

### 작성 예시

```
작업명          | 설명              | 팀         | 담당자      | 예상완료일  | 우선순위 | 상태
---------------|-------------------|------------|-------------|------------|----------|----------
제품 A 제조     | 제조 공정 진행     | production | John Park   | 2025-11-20 | 8        | pending
원자재 검수     | 입고 품질 검사     | logistics  | Sarah Kim   | 2025-11-15 | 9        | pending
포장 작업       | 완제품 포장        | production |             | 2025-11-25 | 5        | pending
```

### 중요 주의사항

#### 1️⃣ 팀 이름 입력

**올바른 값:**
- `production` (생산팀)
- `logistics` (물류팀)

**잘못된 예시:**
- ❌ `생산팀`, `물류팀` (한글)
- ❌ `Production`, `LOGISTICS` (대소문자 틀림)
- ❌ `prod`, `log` (약어)

#### 2️⃣ 날짜 형식

**올바른 형식:**
- `2025-11-20`
- `2025-12-31`

**잘못된 예시:**
- ❌ `11/20/2025` (미국식)
- ❌ `2025.11.20` (점 구분자)
- ❌ `20-11-2025` (순서 틀림)

💡 **팁**: 엑셀에서 날짜 셀을 선택하고 서식을 `YYYY-MM-DD`로 설정하세요.

#### 3️⃣ 우선순위

- 1~10 사이의 **정수**만 입력
- 1 = 가장 낮음, 10 = 가장 높음
- 입력하지 않으면 자동으로 5가 할당됩니다

#### 4️⃣ 담당자 매칭

시스템은 입력된 담당자 이름/이메일을 다음과 같이 검색합니다:

```
입력값: "John"
→ 검색: 이름에 "John"이 포함된 사용자 또는 이메일에 "John"이 포함된 사용자
→ 매칭: "John Park", "john@company.com"
```

**매칭 예시:**
- ✅ `John` → `John Park`
- ✅ `john@company` → `john@company.com`
- ✅ `Park` → `John Park`
- ❌ `Jon` → 매칭 실패 (오타)

담당자를 찾지 못하면 해당 작업은 **미배정** 상태로 생성됩니다.

---

## 파일 업로드

### 단계별 업로드 과정

#### 1️⃣ 파일 업로드 시작

1. **작업 관리** 페이지에서 우측 상단의 **"파일 업로드"** 버튼 클릭 (보라색)
2. 파일 업로드 모달 창이 나타납니다

#### 2️⃣ 파일 선택

**방법 1: 파일 선택 버튼**
1. **"파일 선택"** 버튼 클릭
2. 엑셀 파일 선택

**방법 2: 드래그 앤 드롭**
1. 엑셀 파일을 드래그하여 업로드 영역에 드롭

#### 3️⃣ 미리보기 확인

파일을 선택하면 자동으로:
- ✅ 파일 파싱 (브라우저에서 처리)
- ✅ 데이터 추출 및 검증
- ✅ 미리보기 표시

미리보기에서 확인할 수 있는 정보:
- 총 작업 개수
- 첫 5개 작업의 요약 정보
- 작업명, 팀, 예상완료일, 우선순위

#### 4️⃣ 업로드 모드 선택

**새 작업 생성 (기본값)**
- 모든 데이터를 새로운 작업으로 생성
- 작업ID 컬럼은 무시됩니다

**기존 작업 업데이트**
- 작업ID 컬럼에 있는 ID로 기존 작업 업데이트
- 작업ID가 없는 행은 실패 처리됩니다

#### 5️⃣ 업로드 실행

1. **"업로드"** 버튼 클릭
2. 서버로 데이터 전송
3. 처리 결과 확인

#### 6️⃣ 결과 확인

업로드 결과는 성공/실패로 구분되어 표시됩니다:

**성공한 항목:**
```
✅ 성공 (2개)
행 2: 제품 A 제조 (ID: 13)
행 3: 원자재 검수 (ID: 14)
```

**실패한 항목:**
```
❌ 실패 (1개)
행 4: 포장 작업 - Invalid team: prod. Must be 'production' or 'logistics'
```

---

## 업로드 모드

### 모드 1: 새 작업 생성

**사용 시나리오:**
- 새로운 작업들을 대량으로 등록할 때
- 프로젝트 시작 시 초기 작업 목록 입력

**동작 방식:**
- 엑셀의 각 행이 새로운 작업으로 생성됩니다
- 작업ID 컬럼이 있어도 무시됩니다
- 중복된 작업명도 모두 생성됩니다

**엑셀 예시:**
```
작업명        | 팀         | 예상완료일  | 우선순위
-------------|------------|------------|----------
작업 A       | production | 2025-11-20 | 8
작업 B       | logistics  | 2025-11-22 | 7
작업 C       | production | 2025-11-25 | 6
```

**API 엔드포인트:** `POST /api/tasks/bulk`

### 모드 2: 기존 작업 업데이트

**사용 시나리오:**
- 기존 작업들의 상태, 우선순위, 담당자 등을 일괄 변경할 때
- 외부에서 관리하던 작업 목록을 시스템에 동기화할 때

**동작 방식:**
- 작업ID 컬럼이 **필수**입니다
- ID에 해당하는 작업이 없으면 실패 처리됩니다
- 입력된 컬럼만 업데이트됩니다 (빈 셀은 기존 값 유지)

**엑셀 예시:**
```
작업ID | 작업명        | 상태        | 우선순위
-------|--------------|-------------|----------
12     | 작업 A       | completed   | 10
13     | 작업 B       | in_progress | 8
14     |              | pending     | 5
```

위 예시에서:
- 작업 12: 상태를 `completed`로, 우선순위를 10으로 변경
- 작업 13: 상태를 `in_progress`로, 우선순위를 8로 변경
- 작업 14: 작업명은 그대로 두고 상태만 `pending`, 우선순위만 5로 변경

**API 엔드포인트:** `PUT /api/tasks/bulk`

---

## 문제 해결

### 자주 발생하는 오류

#### 1. "Invalid team" 오류

**오류 메시지:**
```
Invalid team: 생산팀. Must be 'production' or 'logistics'
```

**원인:**
- 팀 이름을 한글로 입력했거나 영문 철자가 틀렸습니다

**해결 방법:**
- 팀 컬럼에 정확히 `production` 또는 `logistics`를 입력하세요
- 대소문자를 정확히 지켜주세요 (모두 소문자)

#### 2. "Missing required fields" 오류

**오류 메시지:**
```
Missing required fields: name, team, or expected_completion
```

**원인:**
- 필수 컬럼(작업명, 팀, 예상완료일) 중 하나가 비어있습니다

**해결 방법:**
- 해당 행의 필수 컬럼을 모두 채워주세요
- 빈 행이 있는지 확인하세요

#### 3. "Invalid priority" 오류

**오류 메시지:**
```
Invalid priority: 15. Must be between 1 and 10
```

**원인:**
- 우선순위에 1~10 범위를 벗어난 값을 입력했습니다

**해결 방법:**
- 우선순위는 1~10 사이의 정수만 입력하세요
- 소수점은 사용할 수 없습니다

#### 4. "You can only create tasks for your team" 오류

**오류 메시지:**
```
You can only create tasks for your team (production)
```

**원인:**
- 자신의 팀이 아닌 다른 팀의 작업을 생성하려고 했습니다
- Admin 권한이 있는 사용자만 모든 팀의 작업을 생성할 수 있습니다

**해결 방법:**
- 자신의 팀에 해당하는 작업만 포함시키세요
- 또는 Admin 계정으로 로그인하세요

#### 5. "Task with ID X not found" 오류

**오류 메시지:**
```
Task with ID 999 not found
```

**원인:**
- 업데이트 모드에서 존재하지 않는 작업ID를 입력했습니다

**해결 방법:**
- 시스템에서 작업 목록을 확인하여 올바른 ID를 입력하세요
- 새 작업을 생성하려면 "새 작업 생성" 모드를 선택하세요

### 일반적인 팁

#### 📌 대용량 파일 업로드

- 한 번에 **100개 이하**의 작업을 업로드하는 것을 권장합니다
- 더 많은 작업이 있다면 여러 파일로 나누어 업로드하세요

#### 📌 담당자가 매칭되지 않을 때

- 담당자 이름을 정확히 입력했는지 확인하세요
- 시스템에 해당 사용자가 등록되어 있는지 확인하세요
- Admin 권한으로 **"사용자 관리"** 페이지에서 사용자 목록을 확인할 수 있습니다

#### 📌 날짜 형식 문제

엑셀에서 날짜 셀 서식을 설정하는 방법:
1. 날짜 셀 선택
2. 마우스 오른쪽 클릭 → **"셀 서식"**
3. **"사용자 지정"** 선택
4. 형식: `yyyy-mm-dd` 입력
5. 확인

#### 📌 한글/영문 컬럼명 혼용

시스템은 한글과 영문 컬럼명을 모두 인식합니다:

**한글 헤더:**
```
작업명 | 팀 | 예상완료일
```

**영문 헤더:**
```
name | team | expected_completion
```

둘 다 정상적으로 처리됩니다!

---

## API 레퍼런스

개발자를 위한 API 엔드포인트 정보입니다.

### POST /api/tasks/bulk

**설명:** 여러 작업을 한 번에 생성

**인증:** Bearer Token 필요

**요청 본문:**
```json
{
  "tasks": [
    {
      "name": "작업명",
      "description": "설명 (선택)",
      "team": "production",
      "assigned_to": "담당자 이름 또는 이메일 (선택)",
      "expected_completion": "2025-11-20",
      "priority": 8,
      "status": "pending"
    }
  ]
}
```

**응답 예시:**
```json
{
  "message": "Processed 3 tasks: 2 succeeded, 1 failed",
  "results": {
    "success": [
      {
        "row": 2,
        "task": "작업 A",
        "id": 13
      }
    ],
    "failed": [
      {
        "row": 3,
        "task": "작업 B",
        "error": "Invalid team: prod. Must be 'production' or 'logistics'"
      }
    ],
    "total": 3
  }
}
```

### PUT /api/tasks/bulk

**설명:** 여러 작업을 한 번에 업데이트

**인증:** Bearer Token 필요

**요청 본문:**
```json
{
  "tasks": [
    {
      "id": 12,
      "name": "변경된 작업명",
      "status": "completed",
      "priority": 10
    }
  ]
}
```

**응답 예시:**
```json
{
  "message": "Processed 2 tasks: 2 succeeded, 0 failed",
  "results": {
    "success": [
      {
        "row": 2,
        "task": "작업 A",
        "id": 12
      }
    ],
    "failed": [],
    "total": 2
  }
}
```

### 권한 및 제약사항

| 역할 | 생성 가능 팀 | 업데이트 가능 팀 |
|------|-------------|-----------------|
| **Admin** | 모든 팀 | 모든 팀 |
| **Production** | Production만 | Production만 |
| **Logistics** | Logistics만 | Logistics만 |

---

## 추가 지원

### 문의하기

엑셀 업로드 관련 문제가 해결되지 않으면:

1. 시스템 관리자에게 문의하세요
2. GitHub Issues에 문제를 보고하세요
3. `USAGE_GUIDE.md`의 FAQ 섹션을 참고하세요

### 관련 문서

- **[사용자 가이드](USAGE_GUIDE.md)**: 전체 시스템 사용 방법
- **[API 문서](API_DOCUMENTATION.md)**: 모든 API 엔드포인트
- **[README](README.md)**: 프로젝트 개요

---

**마지막 업데이트:** 2025-11-06
**버전:** 1.0.0
